{% extends "index.html" %}
{% load staticfiles %}

{% block content %}
  <div class="row">
    <div class="large-12 medium-12 columns">
      <h2>{{ book.title }}</h2>
    </div>
  </div>

  <div class="book-details row">
    <div class="large-4 medium-4 columns">
      <div class="cover">
        <img src="{{ book.cover.url }}" />
      </div>
      <div class="rating-row row">
        <div class="rating-label large-2 medium-2 columns">Plin rating:</div>
        <div class="rating-value large-10 medium-10 columns">
          <div class="rating" data-rating="{{ book.overall_rating }}"
                              data-model="book"
                              data-pk="{{ book.pk }}"
                              data-read-only="true"></div>
          <div class="votes">({{ book.rating_votes }} vote{{ book.rating_votes|pluralize }})</div>
        </div>
      </div>
      {% if request.user.is_authenticated %}
      <div class="rating-row row">
        <div class="rating-label large-2 medium-2 columns">Your rating:</div>
        <div class="rating-value large-10 medium-10 columns">
          <div class="rating" data-rating="{{ book_user_rating }}"
                              data-model="book"
                              data-pk="{{ book.pk }}"
                              data-read-only="false"></div>
        </div>
      </div>
      {% endif %}
    </div>
    <div class="book-description large-8 medium-8 columns">
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">Título</div>
        <div class="book-value large-9 medium-9 columns">{{ book.title }}</div>
      </div>
      {% if book.subtitle %}
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">Subtítulo</div>
        <div class="book-value large-9 medium-9 columns">{{ book.title }}</div>
      </div>
      {% endif %}
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">Idioma</div>
        <div class="book-value large-9 medium-9 columns">{{ book.get_language_display }}</div>
      </div>
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">Autor</div>
        <div class="book-value large-9 medium-9 columns">{{ book.author }}</div>
      </div>
      {% if book.illustrator %}
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">Ilustrador</div>
        <div class="book-value large-9 medium-9 columns">{{ book.illustrator }}</div>
      </div>
      {% endif %}
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">Editorial</div>
        <div class="book-value large-9 medium-9 columns">{{ book.editor }}</div>
      </div>
      {% if book.collection %}
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">Coleção</div>
        <div class="book-value large-9 medium-9 columns">{{ book.collection }}</div>
      </div>
      {% endif %}
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">Nível de leitor</div>
        <div class="book-value large-9 medium-9 columns">{{ book.reader_level }}</div>
      </div>
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">N° de páginas</div>
        <div class="book-value large-9 medium-9 columns">{{ book.nb_pages }}</div>
      </div>
      <div class="book-description-row row">
        <div class="book-label large-3 medium-3 columns">Tema</div>
        <div class="book-value large-9 medium-9 columns">
          {% for keyword in book.keywords.all %}
            {{ keyword }}
          {% endfor %}
        </div>
      </div>

      <div class="book-description-row row">
        <div class="large-12 medium-12 columns">
          <h3>Synopsis</h3>
          <div>{{ book.synopsis|linebreaks }}</div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block additional_js %}
<script src='{% static "js/vendor/jquery.cookie.js" %}'></script>
<script src='{% static "js/vendor/jquery.json.min.js" %}'></script>
<script src='{% static "js/vendor/jquery.raty.min.js" %}'></script>
<script type="text/javascript">
  $(function() {
    $.fn.raty.defaults.path = '{% static "img/rating" %}';

    $('.rating').each(function(index, rating_dom) {
      console.log(rating_dom);
      $(rating_dom).raty({
        starOff : 'star-off.png',
        starOn  : 'star-on.png',
        size    : 24,
        readOnly: $(rating_dom).data('read-only'),
        score   : function() {
          return $(this).attr('data-rating');
        },
        click   : function(rating, evt) {
          var model_name = $(this).data('model'),
              object_pk = $(this).data('pk');

          $.ajax({
            type: 'POST',
            url: '/bookshelf/rate/' + model_name + '/' + object_pk + '/',
            data: $.toJSON({rating: rating}),
            dataType: 'json'
          });
        }
      });
    });
  });
</script>
{% endblock %}
